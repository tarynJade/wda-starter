<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Movie Details</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./js/tailwindConfig.js"></script>
    <script src="./js/scripts.js"></script>
  </head>
  <body>
    <header
      class="fixed top-0 left-0 right-0 z-50 bg-white flex items-center justify-between py-2 md:py-4 shadow-md px-2 md:px-4"
    >
      <div>
        <a
          href="index.html"
          class="text-xl md:text-4xl pl-2 md:pl-16 flex items-center gap-2"
        >
          <img
            src="./assets/scene-it-high-resolution-logo-transparent.png"
            alt="SceneIt Logo"
            class="w-16 h-5 sm:w-24 sm:h-8 md:w-36 md:h-10"
          />
        </a>
      </div>

      <div class="flex items-center">
        <nav
          class="flex items-center space-x-2 sm:space-x-4 lg:space-x-6 text-gray-700 pr-2 md:pr-16"
        >
          <a
            class="hover:text-cerise text-xs sm:text-sm lg:text-base"
            href="index.html"
          >
            Home
          </a>
          <a
            class="hover:text-cerise text-xs sm:text-sm lg:text-base"
            href="watchlist.html"
          >
            My Watchlist
          </a>
        </nav>
      </div>
    </header>

    <div
      x-data="movieComponent"
      x-init="init()"
      class="flex justify-center items-start pt-16 sm:pt-20 md:pt-24 px-4 bg-navy"
    >
      <div
        class="w-full max-w-4xl rounded-lg shadow-lg p-8 flex flex-col bg-white border-4 border-salmon"
        x-show="movie"
      >
        <!-- Movie Title -->
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-4">
          <h1 class="text-xl sm:text-2xl md:text-3xl font-bold sm:text-left" x-text="movie?.title"></h1>
        </div>

        <div class="w-full mb-2">
           <button 
                @click="toggleWatchlist(movie)"
                class="text-white font-semibold py-3 px-4 rounded-lg text-sm transition-colors mb-4"
                :class="movie && isInWatchlist(movie.id) ? 'bg-cerise hover:bg-salmon' : 'bg-cerise hover:bg-salmon'"
                :aria-label="movie && isInWatchlist(movie.id) ? 'Remove from watchlist' : 'Add to watchlist'"
                x-text="movie && isInWatchlist(movie.id) ? 'Remove from Watchlist' : 'Add to Watchlist'"
                :disabled="!movie"
              >
              </button>
        </div>

        <!-- Trailer button and Add to / remove from watchlist button -->
        <div x-show="trailer && trailer.key" class="w-full mb-8 sm:w-auto gap-2">
          <div x-data="{ showTrailer: false }">
            <div class="flex justify-between">
              <button 
                @click="showTrailer = !showTrailer"
                class="bg-red-700 hover:bg-red-300 text-white font-semibold py-3 px-4 rounded-lg text-sm transition-colors mb-4"
                x-text="showTrailer ? 'Hide Trailer' : '▶️ Watch Trailer'"
              >
              </button>
            </div>
            <div x-show="showTrailer" x-transition class="relative w-full mx-auto max-w-2xl" style="padding-bottom: 45%;">
              <iframe
                :src="showTrailer && trailer?.key ? `https://www.youtube.com/embed/${trailer.key}` : ''"
                class="absolute top-0 left-0 w-full h-full rounded-lg shadow-lg"
                frameborder="0"
                allow="picture-in-picture"
                allowfullscreen
              ></iframe>
            </div>
          </div>
        </div>

        <!-- Movie information -->
        <div class="flex flex-col md:flex-row gap-8 w-full">
          <div>
            <img
              class="w-48 h-72 sm:w-56 sm:h-84 md:w-64 md:h-96 rounded shadow object-cover mx-auto md:mx-0"
              :src="movie?.poster_path ? `https://image.tmdb.org/t/p/w500${movie.poster_path}` : ''"
              :alt="movie?.title || 'Movie poster'"
              width="300" height="450"
            />
            <p x-show="movie?.vote_average" class="text-2xl p-4 pl-0">
              ⭐ <span x-text="Math.round(movie?.vote_average * 10) / 10"></span>
            </p>
            <p>
              <strong>Runtime:</strong>
              <span x-text="`${movie?.runtime} minutes`"></span>
            </p>
          </div>

          <div
            class="flex-1 flex flex-col items-center md:items-start text-center md:text-left w-full"
          >
            <p class="mb-4">
              <strong>Overview:</strong> <span x-text="movie?.overview"></span>
            </p>
            <div class="flex flex-col w-full items-center md:items-start">
              <p class="mb-2">
                <strong>Release Year:</strong>
                <span x-text="movie?.release_date ? new Date(movie.release_date).getFullYear() : 'Unknown Year'"></span>
              </p>
              <p>
                <strong>Genre:</strong>
                <ul class="pb-4">
                  <template x-for="(genre, index) in movie?.genres || []" :key="genre.id">
                    <li x-text="genre.name"></li>
                  </template>
                </ul>
              </p>
              <p class="mb-4">
                <strong>Cast: </strong>
                <div class="flex flex-wrap gap-4 mt-2">
                  <template x-for="(actor, index) in castList" :key="actor.id">
                    <div class="flex items-center gap-2 bg-gray-50 rounded-lg p-2">
                      <img
                        class="w-12 h-12 rounded-full object-cover shadow"
                        :src="actor.profile_path ? `https://image.tmdb.org/t/p/w185${actor.profile_path}` : 'https://via.placeholder.com/48x48'"
                        :alt="actor.name + ' profile photo'"
                      >
                      <a 
                        class="text-blue-600 underline hover:text-blue-800 text-sm" 
                        x-text="actor.name"
                        :href="`https://www.themoviedb.org/person/${actor.id}`" 
                        target="_blank"
                      >
                      </a>
                    </div>
                  </template>
                </div>
              </p>
            </div>
          </div>
        </div>

         <!-- Recommendation caurosel -->
        <div x-show="recommendations" class="w-full mt-8">
          <h1 class="text-lg sm:text-xl font-bold pb-2">More movies like this one:</h1>
          <div class="flex overflow-x-auto gap-4 bg-navy p-6">
            <template x-for="recommendation in recommendations.slice(0,8)" :key="recommendation.id">
              <div class=" w-48 flex-shrink-0 border-2 border-salmon rounded-lg p-3 bg-white">
                <img
                  @click="window.location.href =`movie.html?movie_id=${recommendation.id}`"
                  class="h-72 rounded-md"
                  :src="`https://image.tmdb.org/t/p/w300${recommendation.poster_path}`"
                  :alt="recommendation.title"
                  width="300" height="450"
                />
                <a
                  :href="`movie.html?movie_id=${recommendation.id}`"
                  x-text="recommendation.title"
                  class="block text-center text-sm font-medium hover:text-blue-600 mt-2 pb-3 leading-tight line-clamp-2"
                ></a>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>