<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Showing Movie Data from an API</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./js/tailwindConfig.js"></script>
    <script src="./js/scripts.js"></script>
  </head>
  <body class="pt-20 bg-navy">
    <header
      class="fixed top-0 left-0 right-0 z-50 bg-white flex items-center justify-between py-2 md:py-4 shadow-md px-2 md:px-4"
    >
      <div>
        <a
          href="index.html"
          class="text-xl md:text-4xl pl-2 md:pl-16 flex items-center gap-2"
        >
          <img
            src="./scene-it-high-resolution-logo-transparent.png"
            alt="SceneIt Logo"
            class="w-16 h-5 sm:w-24 sm:h-8 md:w-36 md:h-10"
          />
        </a>
      </div>

      <div class="flex items-center">
        <nav
          class="flex items-center space-x-2 sm:space-x-4 lg:space-x-6 text-gray-700 pr-2 md:pr-16"
        >
          <a
            href="#search-section"
            class="hover:text-cerise text-xs sm:text-sm lg:text-base"
          >
            Search
          </a>
          <a
            class="hover:text-cerise text-xs sm:text-sm lg:text-base"
            href="index.html"
          >
            Home
          </a>
          <a
            class="hover:text-cerise text-xs sm:text-sm lg:text-base"
            href="watchlist.html"
          >
            My Watchlist
          </a>
        </nav>
      </div>
    </header>

    <div class="py-1 bg-salmon"></div>

    <div x-data="movieListComponent" x-init="init()">
      <section class="bg-white py-8" id="search-section">
        <div class="container mx-auto px-4">
          <h2 class="text-4xl text-center mb-6 text-black">
            Discover Your Next Favourite Film.
          </h2>

          <!-- Search component-->
          <div class="flex justify-center items-center gap-4">
            <input
              class="w-full md:w-96 p-4 text-sm text-gray-900 border border-navy rounded-lg bg-white focus:ring-pink-400"
              type="text"
              x-model="search_query"
              @input.debounce.300ms="loadMovies()"
              placeholder="Search movies..."
            />
          </div>
          <!-- Filters component-->
          <div class="flex justify-end pt-6 space-x-2">
            <select
              class="w-full md:w-auto border border-gray-300 rounded-lg bg-salmon focus:ring-cerise p-3 flex justify-end p-2"
              x-model="filter_year"
              @change="loadMovies()"
              aria-label="filter by year"
            >
              <option label="New Release" value="New Release">
                New Releases
              </option>
              <option label="2024" value="2024">2024</option>
              <option label="2023" value="2023">2023</option>
              <option label="2022" value="2022">2022</option>
              <option label="2021" value="2021">2021</option>
              <option label="2020" value="2020">2020</option>
              <option label="2019" value="2019">2019</option>
              <option label="2018" value="2018">2018</option>
              <option label="2017" value="2017">2017</option>
              <option label="2016" value="2016">2016</option>
              <option label="2015" value="2015">2015</option>
              <option label="2014" value="2014">2014</option>
            </select>
            <select
              class="w-full sm:w-auto border border-gray-300 rounded-lg bg-salmon focus:ring-cerise p-3"
              x-model="filter_genre"
              @change="loadMovies()"
              aria-label="filter by genre"
            >
              <option value="">Genre Filter</option>
              <template x-for="genre in genres" :key="genre.id">
                <option :value="genre.id" x-text="genre.name"></option>
              </template>
            </select>
            <select
              class="w-full sm:w-auto border border-gray-300 rounded-lg bg-salmon focus:ring-cerise p-3"
              x-model="filter_runtime"
              @change="loadMovies()"
              aria-label="filter by runtime"
            >
              <option value="">Duration Filter</option>
              <option value="short">Short (Under 90 min)</option>
              <option value="medium">Medium (90-150 min)</option>
              <option value="long">Long (Over 150 min)</option>
            </select>
          </div>
        </div>
      </section>

      <section class="container mx-auto px-4 py-8" id="movie-container">
        <div class="flex items-center justify-between mb-6" id="movie-header-container">
          <h2 class="text-2xl font-bold text-white">Movies</h2>
          <div class="flex justify-end gap-2" id="filters-container">
           <!-- Year Filter Display -->
          <div x-show="filter_year !== ''">
            <span class="rounded-lg bg-gray-100 p-2 text-s text-gray-700">
              <span class="font-medium" x-text="filter_year"></span>
            </span>
          </div>
          <!-- Genre Filter Display -->
          <div x-show="filter_genre !== ''">
            <span class="rounded-lg bg-gray-100 p-2 text-s text-gray-700">
              <span
                class="font-medium"
                x-text="genres.find(g => g.id == filter_genre).name || filter_genre"
              ></span>
            </span>
          </div>

          <!-- Runtime Filter Display -->
          <div x-show="filter_runtime !== ''">
            <span class="rounded-lg bg-gray-100 p-2 text-s text-gray-700">
              <span
                class="font-medium"
                x-text="filter_runtime === 'short' ? 'Short (Under 90 min)' : filter_runtime === 'medium' ? 'Medium (90-150 min)' : filter_runtime === 'long' ? 'Long (Over 150 min)' : filter_runtime"
              ></span>
            </span>
          </div>
          </div>
        </div>

        <div
          class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"
        >
          <div x-show="loading" class="col-span-full text-center py-8">
            <div class="text-white text-lg">Loading movies...</div>
          </div>

          <div
            x-show="error"
            class="col-span-full text-center py-8 text-xl bg-white"
            x-text="error"
          ></div>

          <template x-for="movie in movies" :key="movie.id">
            <div class="group border-4 border-salmon rounded-lg p-3 bg-white">
              <img
                @click="window.location.href =`movie.html?movie_id=${movie.id}`"
                class="w-full object-cover rounded-lg shadow-md group-hover:shadow-lg transition-shadow cursor-pointer"
                :src="`https://image.tmdb.org/t/p/w300${movie.poster_path}`"
                :alt="movie.title"
              />
              <a
                :href="`movie.html?movie_id=${movie.id}`"
                x-text="movie.title"
                class="block text-center text-sm font-medium text-gray-900 hover:text-blue-600 mt-2 leading-tight"
              ></a>
               <div class="flex items-center mt-2" x-show="movie.vote_average">
                      <span class="text-yellow-500 text-sm">‚≠ê</span>
                      <span class="text-xs text-gray-600 ml-1" x-text="Math.round((movie.vote_average || 0) * 10) / 10"></span>
                    </div>
            </div>
          </template>
        </div>
      </section>
    </div>
  </body>
</html>
